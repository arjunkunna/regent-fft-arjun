name: Regent-FFT Tests
run-name: ${{ github.actor }} is testing Regent-FFT
on: 
  push:
  workflow_dispatch:

jobs:
  regent-FFT-tests:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: ['ubuntu-22.04'] # 'macos-11' # FIXME: macOS is broken: https://github.com/StanfordLegion/legion/issues/213
        debug: ['1', '0']

    steps:
      - name: Install CUDA Toolkit
        uses: Jimver/cuda-toolkit@v0.2.14
        id: cuda-toolkit
        with:
          cuda: '12.3.2'

      - name: Check CUDA Version
        run: echo "Installed CUDA version is: ${{steps.cuda-toolkit.outputs.cuda}}"

      - name: Print CUDA Installation Location
        run: echo "CUDA install location: ${{steps.cuda-toolkit.outputs.CUDA_PATH}}"

      - name: Check nvcc Version
        run: nvcc -V

      - name: Checkout Repository
        uses: actions/checkout@v1

      - name: Run Test Script
        run: ./test.sh
        env:
          DEBUG: ${{ matrix.debug }}
          USE_REGENT: '1'
          INSTALL_DEPS: '1'
          SUDO_COMMAND: sudo
